name: Excel File Validator

on:
  push:
    paths:
      - ScienceFair.xlsx
  workflow_dispatch:
    
jobs:
  validate_excel:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Download Apache POI dependencies
        run: |
          mkdir -p lib
          cd lib
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/poi/poi/5.2.3/poi-5.2.3.jar
          # Both are needed: regular + full schemas
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/poi/poi-ooxml/5.2.3/poi-ooxml-5.2.3.jar
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/poi/poi-ooxml-full/5.2.3/poi-ooxml-full-5.2.3.jar
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/xmlbeans/xmlbeans/5.1.1/xmlbeans-5.1.1.jar
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/commons/commons-collections4/4.4/commons-collections4-4.4.jar
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.21/commons-compress-1.21.jar
          curl -L -f -O https://repo1.maven.org/maven2/com/github/virtuald/curvesapi/1.07/curvesapi-1.07.jar
          curl -L -f -O https://repo1.maven.org/maven2/com/zaxxer/SparseBitSet/1.2/SparseBitSet-1.2.jar
          curl -L -f -O https://repo1.maven.org/maven2/commons-io/commons-io/2.11.0/commons-io-2.11.0.jar
          curl -L -f -O https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-api/2.20.0/log4j-api-2.20.0.jar

          # Keep debug output
          ls -lh
          file *.jar

      - name: Compile ExcelMonitor
        run: |
          mkdir -p target/classes
          javac \
            -sourcepath src/main/java \
            -d target/classes \
            -cp "lib/*" \
            src/main/java/com/example/ExcelMonitor.java

      - name: Run validator
        run: |
          java \
            -cp "target/classes:lib/*" \
            com.example.ExcelMonitor \
            ScienceFair.xlsx
